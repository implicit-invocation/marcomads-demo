(this.webpackJsonpmarcomads=this.webpackJsonpmarcomads||[]).push([[0],{2:function(e){e.exports=JSON.parse('{"name":"marcomads","version":"0.1.0","homepage":"/marcomads-demo","private":true,"dependencies":{"fbemitter":"^2.1.1","gl-basic-shader":"^1.3.0","gl-matrix":"^3.1.0","gl-sprite-batch":"^3.1.1","gl-texture2d":"^2.1.0","kami-batch":"github:implicit-invocation/kami-batch","kami-texture":"^1.1.0","ndarray-from-image":"^1.0.1","react":"^16.10.2","react-dom":"^16.10.2","react-scripts":"3.2.0"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]}}')},29:function(e,t,n){e.exports=n(47)},34:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(16),c=n.n(i),o=(n(34),n(11)),l=n(3),s=n(5),u=n.n(s),p=n(8),h=n(9);var g=function(e){var t=e.onInit,n=e.onClick,i=e.onResize,c=Object(h.a)(e,["onInit","onClick","onResize"]),o=Object(r.useRef)(null),l=Object(r.useCallback)((function(){var e=o.current;!function(e){var t=e.clientWidth,n=e.clientHeight;e.width===t&&e.height===n||(e.width=t,e.height=n)}(e),i&&i(e.width,e.height)}),[i]),s=Object(r.useCallback)((function(e){var t=o.current.getBoundingClientRect(),r=e.clientX-t.left,a=e.clientY-t.top;n&&n(r,a)}),[n]),u=Object(r.useMemo)((function(){return"ontouchstart"in window?{onTouchStart:s}:{onClick:s}}),[s]);return Object(r.useEffect)((function(){var e=o.current;l(),window.addEventListener("resize",l);var n=t&&t(e.getContext("webgl"),e.width,e.height);return function(){n&&Promise.resolve(n).then((function(e){return e()})),window.removeEventListener("resize",l)}}),[l,t]),console.log(u),a.a.createElement("canvas",Object.assign({},u,{ref:o},c))},f=n(17),m=n.n(f),d=n(1),v=function(e,t,n,r,a,i,c){var o=Object(l.a)(t,3),s=o[0],u=o[1],p=o[2];return s-=r,u=c-u-1,u-=a,e[0]=2*s/i-1,e[1]=2*u/c-1,e[2]=2*p-1,function(e,t,n){var r=Object(l.a)(t,3),a=r[0],i=r[1],c=r[2],o=n,s=o[0],u=o[1],p=o[2],h=o[3],g=o[4],f=o[5],m=o[6],d=o[7],v=o[8],b=o[9],w=o[10],k=o[11],x=o[12],y=o[13],O=o[14],j=1/(a*h+i*d+c*k+o[15]);return e[0]=(a*s+i*g+c*v+x)*j,e[1]=(a*u+i*f+c*b+y)*j,e[2]=(a*p+i*m+c*w+O)*j,e}(e,e,n)},b=function(e,t,n,r){var a=d.a.create();d.a.ortho(a,0,e,t,0,0,1);var i=d.a.create();d.a.invert(i,a);var c=d.a.create(),o=[0,0,0],l=[],s=[],u=[],p=[];return{combined:a,setMatrix:function(e){d.a.copy(a,e),d.a.invert(i,a)},unprojectVector2:function(e,t){o[0]=t[0],o[1]=t[1],o[2]=0,v(o,o,i,0,0,n,r),e[0]=o[0],e[1]=o[1]},resize:function(e,t){d.a.ortho(a,0,e,t,0,0,1),d.a.invert(i,a)},translate:function(e,t){p.length=0,p[0]=e,p[1]=t,p[2]=0,d.a.translate(a,a,p),d.a.invert(i,a)},scale:function(e,t,n){l.length=0,l[0]=e,l[1]=t,l[2]=0,s.length=0,s[0]=n,s[1]=n,s[2]=1,u.length=0,u[0]=-e,u[1]=-t,u[2]=0,d.a.identity(c),d.a.translate(c,c,l),d.a.scale(c,c,s),d.a.translate(c,c,u),d.a.mul(a,a,c),d.a.invert(i,a)}}},w=n(10),k=n.n(w),x=function(e,t,n){return new Promise((function(n){var r=new Image;r.src=t,r.onload=function(){var t=new k.a(e,{image:r});t.setFilter(k.a.Filter.LINEAR,k.a.Filter.LINEAR,!1),n(t)}}))},y=n(18),O=n(19),j=function(){function e(t,n,r,a,i,c,o,l){Object(y.a)(this,e),o&&l||(o=1/t.width,l=1/t.height);var s=n*o,u=r*l,p=(n+a)*o,h=(r+i)*l;for(var g in this.texture=t,this.x=n,this.y=r,this.width=a,this.height=i,this.u=s,this.v=u,this.u2=p,this.v2=h,c)this[g]=c[g]}return Object(O.a)(e,[{key:"draw",value:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,s=arguments.length>9&&void 0!==arguments[9]?arguments[9]:1;e.draw(this.texture,t,n,r,a,i,c,o,l,s,this.u,this.v,this.u2,this.v2)}}]),e}();function E(e,t){for(var n=e.split("/"),r=t.split("/"),a=[],i=0,c=n.length;i<c;i++)if(".."===n[i])a.pop();else{if("."===n[i])continue;a.push(n[i])}for(var o=0,l=r.length;o<l;o++)if(".."===r[o])a.pop();else{if("."===r[o])continue;a.push(r[o])}return a.join("/")}var U=0,C=1,I=function(){var e=Object(p.a)(u.a.mark((function e(t,n){var r,a,i,c,o,s,p,h,g,f,m,d,v,b,w,k,y,O,I,M,P,R,N,S,D,K,L,F,W,z,B,T,H,A,J,X,Y,_,q,V,$;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(n).then((function(e){return e.text()}));case 2:r=e.sent,a=[],i=[],o=r.split("\n"),s=0;case 7:if(void 0!==(h=o[s])){e.next=11;break}return e.abrupt("break",15);case 11:0===h.trim().length?c=null:null===c?(g=E(n,"../".concat(h)),h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),f=parseInt(p[0],10),m=parseInt(p[1],10),h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),d=p[0],h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),v=p,b=Object(l.a)(v,2),w=b[0],k=b[1],h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),y=p[0],O=U,I=U,"x"===y?O=C:"y"===y?I=C:"xy"===y&&(O=C,I=C),c={file:g,width:f,height:m,format:d,mipMaps:"Nearest"!==w&&"Linear"!==w,min:w,max:k,direction:y,repeatX:O,repeatY:I},a.push(c)):(M=h,h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),P="true"===p[0],h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),R=parseInt(p[0],10),N=parseInt(p[1],10),h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),S=parseInt(p[0],10),D=parseInt(p[1],10),K={name:M,rotate:P,left:R,top:N,width:S,height:D,page:c},h=o[++s],4===(p=h.split(":")[1].split(",").map((function(e){return e.trim()}))).length&&(K.splits=p.map((function(e){return parseInt(e,10)})),h=o[++s],4===(p=h.split(":")[1].split(",").map((function(e){return e.trim()}))).length&&(K.pads=p.map((function(e){return parseInt(e,10)})),h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})))),K.originalWidth=parseInt(p[0],10),K.originalHeight=parseInt(p[1],10),h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),K.offsetX=parseInt(p[0],10),K.offsetY=parseInt(p[1],10),h=o[++s],p=h.split(":")[1].split(",").map((function(e){return e.trim()})),K.index=parseInt(p[0],10),i.push(K)),s++,e.next=7;break;case 15:L=0,F=a;case 16:if(!(L<F.length)){e.next=26;break}return W=F[L],e.next=20,x(t,W.file);case 20:W.texture=e.sent,W.invTexWidth=1/W.texture.width,W.invTexHeight=1/W.texture.height;case 23:L++,e.next=16;break;case 26:for(z=[],B=0,T=i;B<T.length;B++)H=T[B],A=H.left,J=H.top,X=H.rotate?H.height:H.width,Y=H.rotate?H.width:H.height,_=H.page,q=_.texture,V=_.invTexWidth,$=_.invTexHeight,z.push(new j(q,A,J,X,Y,H,V,$));return e.abrupt("return",{getRegions:function(){return z},findRegion:function(e,t){for(var n=0;n<z.length;n++){var r=z[n];if(r.name===e&&(void 0===t||r.index===t))return r}return null},findRegions:function(e){return z.filter((function(t){return t.name===e})).sort((function(e,t){return e.index-t.index}))}});case 29:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=0,P=1,R=2,N=3,S=4,D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return{getKeyFrame:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:M,a=Math.floor(n/e);switch(r){case M:a=Math.min(t.length-1,a);break;case P:a%=t.length;break;case R:(a%=2*t.length-2)>=t.length&&(a=t.length-2-(a-t.length));break;case N:a=Math.max(t.length-a-1,0);break;case S:a%=t.length,a=t.length-a-1}return t[a]}}},K=n(20),L=function(e){var t=e.config,n=void 0===t?{characterUrl:"/flappy.atlas",characterKey:"bluebird",backgroundUrl:"/background-day.png",sign01Url:"/sign01.png",sign02Url:"/sign02.png",baseUrl:"/base.png",pipeUrl:"/pipe-green.png"}:t,i=Object(h.a)(e,["config"]),c=Object(r.useMemo)((function(){return new K.EventEmitter}),[]),o=Object(r.useCallback)((function(e,t){return c.emit("canvasClick",e,t)}),[c]),l=Object(r.useCallback)(function(){var e=Object(p.a)(u.a.mark((function e(t,r,a){var i,o,l,s,p,h,g,f,d,v,w,k,y,O,j,E,U,C,M,R,N,S,K,L,F,W;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=m()(t,{size:1e3}),s=b(o=10,l=o*a/r,r,a),e.next=6,x(t,n.backgroundUrl);case 6:return p=e.sent,e.next=9,x(t,n.baseUrl);case 9:return h=e.sent,e.next=12,x(t,n.pipeUrl);case 12:return g=e.sent,e.next=15,I(t,n.characterUrl);case 15:return f=e.sent,e.next=18,x(t,n.sign01Url);case 18:return d=e.sent,e.next=21,x(t,n.sign02Url);case 21:return v=e.sent,w=D(.1,f.findRegions(n.characterKey)),t.viewport(0,0,r,a),1.2,.288/.34,k=0,20,60,y=-Math.PI/6,7,O=o,j=Math.min(o/3,l/5),2.4,768/52,E=.288/.34*5,U=20,C=l/2,M=o,R=function(){M=o,C=l/2,U=0,S[0]=Math.random()*(l-3*j)+j,S[1]=Math.random()*(l-3*j)+j},c.addListener("canvasClick",(function(e,t){N&&(N=!1,R()),U=-20})),N=!1,S=[Math.random()*(l-3*j)+j,Math.random()*(l-3*j)+j],K=[!1,!0],L=function(e){if(t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),!N){U+=60*e,U=Math.min(U,20),C+=U*e,(M-=7*e)<=-o&&(M=0,S[0]=S[1],S[1]=Math.random()*(l-3*j)+j,K[0]=K[1],K[1]=Math.random()>.7&&S[1]>o/2),k+=e,C>l-j&&(N=!0);var n=M+.75*O,r=o/4;if(r<=n+1.2&&r>=n-1.2){var a=S[0];N=C>a+E/2||C<a-E/2}}i.setProjection(s.combined),i.begin(),i.draw(p,0,0,o,l);for(var c=0;c<S.length;c++)i.draw(g,M+.75*O+O*c-1.2,S[c]+E/2,2.4,768/52),i.draw(g,M+.75*O+O*c-1.2,S[c]-E/2-768/52,2.4,768/52,1.2,768/52/2,Math.PI),K[c]&&i.draw(v,M+.75*O+O*c-1.2-6,l/20,6,2.4);M>0&&i.draw(h,M-O,l-j,O,j),M-O+2*O/3+2.4>0&&i.draw(d,M-O+2*O/3-2.4,l-j-1.2*3,4.8,1.2*3),i.draw(h,M,l-j,O,j),i.draw(h,M+O,l-j,O,j),w.getKeyFrame(k,P).draw(i,o/4-.6,C-.288/.34/2,1.2,.288/.34,.6,.288/.34/2,U<0?y:Math.PI/2*U/20),i.end()},F=!0,W=Date.now(),function e(){var t=Date.now()-W;L(t/1e3),W=Date.now(),F&&requestAnimationFrame(e)}(),e.abrupt("return",(function(){return F=!1}));case 49:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[c,n]);return a.a.createElement(g,Object.assign({},i,{onInit:l,onClick:o}))},F=n(2);n(46);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(n,!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var B=function(e){var t=Object(r.useState)(e),n=Object(l.a)(t,2),a=n[0],i=n[1];return[a,function(e,t){return i(z({},a,Object(o.a)({},e,t)))}]};var T=function(){var e=B({characterUrl:"".concat(F.homepage,"/flappy.atlas"),characterKey:"bluebird",backgroundUrl:"".concat(F.homepage,"/background-day.png"),sign01Url:"".concat(F.homepage,"/sign01.png"),sign02Url:"".concat(F.homepage,"/sign02.png"),baseUrl:"".concat(F.homepage,"/base.png"),pipeUrl:"".concat(F.homepage,"/pipe-green.png")}),t=Object(l.a)(e,2),n=t[0],i=t[1],c=Object(r.useState)(n),o=Object(l.a)(c,2),s=o[0],u=o[1];return a.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"100vh",flexDirection:"row",flexWrap:"wrap"}},a.a.createElement(L,{config:s,style:{width:"45vh",height:"90vh",border:"thin solid #ccc"}}),a.a.createElement("div",{style:{alignSelf:"self-start",padding:50,minWidth:"20vw"}},a.a.createElement("form",{onSubmit:function(e){e.preventDefault(),u(z({},n))}},a.a.createElement("div",null,a.a.createElement("label",null,"Background URL:"),a.a.createElement("input",{type:"text",value:n.backgroundUrl,onChange:function(e){return i("backgroundUrl",e.target.value)}}),a.a.createElement("div",{className:"panel"},a.a.createElement("button",{className:"link",onClick:function(e){return i("backgroundUrl","".concat(F.homepage,"/background-day.png"))}},"Use day"),a.a.createElement("button",{className:"link",onClick:function(e){return i("backgroundUrl","".concat(F.homepage,"/background-night.png"))}},"Use night"),a.a.createElement("button",{className:"link",onClick:function(e){return i("backgroundUrl","".concat(F.homepage,"/paris.jpg"))}},"Use Paris"))),a.a.createElement("div",null,a.a.createElement("label",null,"Character URL:"),a.a.createElement("input",{type:"text",value:n.characterUrl,onChange:function(e){return i("characterUrl",e.target.value)}})),a.a.createElement("div",null,a.a.createElement("label",null,"Character key:"),a.a.createElement("input",{type:"text",value:n.characterKey,onChange:function(e){return i("characterKey",e.target.value)}}),a.a.createElement("div",{className:"panel"},a.a.createElement("button",{className:"link",onClick:function(e){return i("characterKey","redbird")}},"Use red"),a.a.createElement("button",{className:"link",onClick:function(e){return i("characterKey","bluebird")}},"Use blue"))),a.a.createElement("div",null,a.a.createElement("label",null,"Sign 01"),a.a.createElement("input",{type:"text",value:n.sign01Url,onChange:function(e){return i("sign01Url",e.target.value)}})),a.a.createElement("div",null,a.a.createElement("label",null,"Sign 02:"),a.a.createElement("input",{type:"text",value:n.sign02Url,onChange:function(e){return i("sign02Url",e.target.value)}})),a.a.createElement("button",null,"Preview"))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(a.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[29,1,2]]]);
//# sourceMappingURL=main.bc639c41.chunk.js.map